<template>
	<view>
		<free-transparent-bar :scrollTop="scrollTop"
		@clickRight="clickRight"></free-transparent-bar>
		<view class="position-relative" style="height: 620rpx;">
			<image src="https://douyinzcmcss.oss-cn-shenzhen.aliyuncs.com/shengchengqi/datapic/1.jpg" mode="aspectFill" style="height: 590rpx;" class="bg-secondary w-100"></image>
			<image src="/static/images/userpic.png" style="width: 120rpx;height: 120rpx;right: 30rpx;" class="bg-secondary rounded position-absolute bottom-0"></image>
			<text class="text-white font-md position-absolute"
			style="bottom: 45rpx;right: 160rpx;">Summer</text>
		</view>
		
		<!-- æœ‹å‹åœˆåˆ—è¡¨ -->
		<free-moment-list v-for="(item,index) in list" :key="index"
		:item="item" :index="index" @action="doAction"></free-moment-list>
		
		<!-- è¯„è®ºæ¡† -->
		<free-popup ref="action" bottom transformOrigin="center bottom">
			<view style="height: 105rpx;" class="bg-light border-top flex align-center px-3">
				<textarea fixed class="bg-white rounded p-2 font-md" style="height: 75rpx;width: 520rpx;" :focus="true" v-model="content"/>
				<free-icon-button
				@click="changeFaceModal">
					<text class="iconfont">&#xe605;</text>
				</free-icon-button>
				<free-main-button name="å‘é€" :disabled="content.length === 0" @click="send"></free-main-button>
			</view>
			<scroll-view v-if="faceModal" scroll-y="true" 
			style="height: 350rpx;"
			class="bg-light flex flex-wrap">
				<view style="width: 107rpx;height: 107rpx;"
				class="flex align-center justify-center"
				hover-class="bg-white"
				v-for="(item,index) in faceList"
				:key="index"
				@click="addFace(item)">
					<text>{{item}}</text>
				</view>
			</scroll-view>
		</free-popup>
		
	</view>
</template>

<script>
	import freeTransparentBar from '@/components/free-ui/free-transparent-bar.vue';
	import freeMomentList from '@/components/free-ui/free-moment-list.vue';
	import freePopup from '@/components/free-ui/free-popup.vue';
	import freeIconButton from "@/components/free-ui/free-icon-button.vue"
	import freeMainButton from '@/components/free-ui/free-main-button.vue';
	export default {
		components: {
			freeTransparentBar,
			freeMomentList,
			freePopup,
			freeIconButton,
			freeMainButton
		},
		data() {
			return {
				content:"",
				scrollTop:0,
				list:[{
					id:2,
					avatar:'/static/images/userpic.png',
					username:'æ˜µç§°',
					context:'é“ä»”ï¼Œå¬è¯´è¿™ä¸ªæœˆä¼šä¸Šçº¿ï¼šå¤–å–é…é€ç³»ç»Ÿå…¨æ ˆæ•™ç¨‹ï¼Œåœ¨çº¿ç‚¹æ’­å…¨æ ˆæ•™ç¨‹ï¼Œå¤šç«¯å®¢æœç³»ç»Ÿï¼Œä¼ä¸šç½‘ç›˜ç³»ç»Ÿ',
					image:[],
					video:false,
					create_time:1567481668,
					supports:[{
						id:1,
						username:"æ˜µç§°",
						avatar:'/static/images/userpic.png',
					}],
					comments:[{
						id:1,
						username:"æ˜µç§°",
						content:"è¯„è®ºå†…å®¹"
					}]
				},{
					id:2,
					avatar:'/static/images/userpic.png',
					username:'æ˜µç§°',
					context:'é“ä»”ï¼Œå¬è¯´è¿™ä¸ªæœˆä¼šä¸Šçº¿ï¼šå¤–å–é…é€ç³»ç»Ÿå…¨æ ˆæ•™ç¨‹ï¼Œåœ¨çº¿ç‚¹æ’­å…¨æ ˆæ•™ç¨‹ï¼Œå¤šç«¯å®¢æœç³»ç»Ÿï¼Œä¼ä¸šç½‘ç›˜ç³»ç»Ÿ',
					image:[{
						src:"https://douyinzcmcss.oss-cn-shenzhen.aliyuncs.com/shengchengqi/datapic/1.jpg"
					}],
					video:false,
					create_time:1567481668,
					supports:[],
					comments:[]
				},{
					id:2,
					avatar:'/static/images/userpic.png',
					username:'æ˜µç§°',
					context:'é“ä»”ï¼Œå¬è¯´è¿™ä¸ªæœˆä¼šä¸Šçº¿ï¼šå¤–å–é…é€ç³»ç»Ÿå…¨æ ˆæ•™ç¨‹ï¼Œåœ¨çº¿ç‚¹æ’­å…¨æ ˆæ•™ç¨‹ï¼Œå¤šç«¯å®¢æœç³»ç»Ÿï¼Œä¼ä¸šç½‘ç›˜ç³»ç»Ÿ',
					image:[{
						src:"https://douyinzcmcss.oss-cn-shenzhen.aliyuncs.com/shengchengqi/datapic/1.jpg"
					},{
						src:"https://douyinzcmcss.oss-cn-shenzhen.aliyuncs.com/shengchengqi/datapic/1.jpg"
					}],
					video:false,
					create_time:1567481668,
					supports:[],
					comments:[]
				},{
					id:2,
					avatar:'/static/images/userpic.png',
					username:'æ˜µç§°',
					context:'é“ä»”ï¼Œå¬è¯´è¿™ä¸ªæœˆä¼šä¸Šçº¿ï¼šå¤–å–é…é€ç³»ç»Ÿå…¨æ ˆæ•™ç¨‹ï¼Œåœ¨çº¿ç‚¹æ’­å…¨æ ˆæ•™ç¨‹ï¼Œå¤šç«¯å®¢æœç³»ç»Ÿï¼Œä¼ä¸šç½‘ç›˜ç³»ç»Ÿ',
					image:[],
					video:{
						src:"/static/video/demo.mp4",
						poster:"https://douyinzcmcss.oss-cn-shenzhen.aliyuncs.com/shengchengqi/datapic/1.jpg"
					},
					create_time:1567481668,
					supports:[],
					comments:[]
				}],
				
				faceModal:false,
				faceList:["ğŸ˜€","ğŸ˜","ğŸ˜‚","ğŸ˜ƒ","ğŸ˜„","ğŸ˜…","ğŸ˜†","ğŸ˜‰","ğŸ˜Š","ğŸ˜‹","ğŸ˜","ğŸ˜","ğŸ˜˜","ğŸ˜—","ğŸ˜™","ğŸ˜š","ğŸ˜‡","ğŸ˜","ğŸ˜‘","ğŸ˜¶","ğŸ˜","ğŸ˜£","ğŸ˜¥","ğŸ˜®","ğŸ˜¯","ğŸ˜ª","ğŸ˜«","ğŸ˜´","ğŸ˜Œ","ğŸ˜›","ğŸ˜œ","ğŸ˜","ğŸ˜’","ğŸ˜“","ğŸ˜”","ğŸ˜•","ğŸ˜²","ğŸ˜·","ğŸ˜–","ğŸ˜","ğŸ˜Ÿ","ğŸ˜¤","ğŸ˜¢","ğŸ˜­","ğŸ˜¦","ğŸ˜§","ğŸ˜¨","ğŸ˜¬","ğŸ˜°","ğŸ˜±","ğŸ˜³","ğŸ˜µ","ğŸ˜¡","ğŸ˜ "],
				// è¯„è®ºçš„å¯¹è±¡
				commentIndex:-1
			}
		},
		onPageScroll(e) {
			this.scrollTop = e.scrollTop
		},
		methods: {
			// ç‚¹å‡»æ“ä½œèœå•
			doAction(e){
				uni.showActionSheet({
					itemList: ['ç‚¹èµ','è¯„è®º'],
					success: res => {
						if(res.tapIndex === 0){
							this.doSupport(e)
						} else {
							this.content = ''
							this.faceModal = false
							this.commentIndex = e.index
							this.$refs.action.show()
						}
					},
				});
			},
			// ç‚¹èµ
			doSupport(e){
				e.item.supports.push({
					id:1,
					username:"æ˜µç§°",
					avatar:'/static/images/userpic.png',
				})
			},
			// æ·»åŠ è¡¨æƒ…
			addFace(item){
				this.content += item
			},
			// å¼€å¯/å…³é—­è¡¨æƒ…åŒ…é¢æ¿
			changeFaceModal(){
				uni.hideKeyboard()
				setTimeout(()=>{
					this.faceModal = !this.faceModal
				},100)
			},
			// å‘é€
			send(){
				this.list[this.commentIndex].comments.push({
					id:1,
					username:"æ˜µç§°",
					content:this.content
				})
				this.$refs.action.hide()
			},
			// é€‰æ‹©å‘è¡¨æœ‹å‹åœˆç±»å‹
			clickRight(){
				let list = [{
					name:"å›¾æ–‡",
					key:"image"
				},{
					name:"çŸ­è§†é¢‘",
					key:"video"
				},{
					name:"æ–‡å­—",
					key:"text"
				}]
				uni.showActionSheet({
					itemList: list.map(v=>v.name),
					success: res => {
						uni.navigateTo({
							url: '../add-moment/add-moment?type='+list[res.tapIndex].key,
						});
					},
				});
			}
		}
	}
</script>

<style>

</style>
